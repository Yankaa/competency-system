{% extends "base.html" %}
{% import 'comp_table.html' as macro %}

{% block title %}
    Система управления компетенциями
{% endblock %}

{% block content %}
    <div class="container">
        <h3>Ваши компетенции</h3>
        {{ macro.div_table(user.competencies, none, 'user_comp_table') }}

        <h3>Поиск компетенций</h3>
        <div class="form-group">
            <select id="area-selector" class="form-control">
                <option value="0">Выберите профессиональную область</option>
                {% for area in areas %}
                    <option value="{{ area.id }}">{{ area.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <select id="prof-selector" class="form-control">
                <option value="0">Выберите профессию</option>
                {% for profession in professions %}
                    <option value="{{ profession.id }}">{{ profession.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <textarea id="comp-text" class="form-control" placeholder="Введите описание компетенции своими словами"></textarea>
        </div>

        {{ macro.div_table([], none, 'found_comp_table') }}

    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type=text/javascript>
        $('#area-selector').change(on_selector_change);
        $('#prof-selector').change(on_selector_change).change();

        function on_selector_change() {
            $.ajax({
                method: 'POST',
                url: {{ url_for('manage_competencies_page.get_prof_comps')|tojson }},
                data: {prof_id: $('#prof-selector').val(), area_id: $('#area-selector').val()}
            }).done(update_tables);
        }

        function update_tables(data) {
            $('#found_comp_table').html(data.found_comp_table);
            if (data.hasOwnProperty('user_comp_table')) {
                $('#user_comp_table').html(data.user_comp_table);
            }
        }

        function change_competency(type, comp_id) {
            $.ajax({
                method: 'POST',
                url: {{ url_for('manage_competencies_page.change_competency')|tojson }},
                data: {type: type, comp_id: comp_id, prof_id: $('#prof-selector').val(), area_id: $('#area-selector').val()}
            }).done(update_tables);
        }
    </script>
{% endblock %}
